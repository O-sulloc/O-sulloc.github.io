---
title:  "[mac] AWS EC2ì— docker ì„¤ì¹˜"
excerpt: "ec2ë€?"

categories:
- aws

tag: [aws, ec2, docker]

toc: true
toc_sticky: true

date: 2022-10-11
---

> ë‹¤ìŒì„ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.
>
> ğŸ“– ê¹€ë‹´í˜•. ã€ì„œë¹„ìŠ¤ ìš´ì˜ì´ ì‰¬ì›Œì§€ëŠ” AWS ì¸í”„ë¼ êµ¬ì¶• ê°€ì´ë“œã€. ìœ„í‚¤ë¶ìŠ¤, 201
> 
> [Aws Ec2 ë„ìš°ê³  ì„œë²„ì— ë“¤ì–´ê°€ì„œ Dockerì„¤ì¹˜í•˜ê¸°](https://youtu.be/29bnOjIOeec)

## EC2?

Elastic Compute Cloud

ì›í•˜ëŠ” ì‹œê°„ë§Œí¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” â€˜ê°€ìƒ ì„œë²„â€™. CentOS, Ubuntu, Windows ë“± ëŒ€ë¶€ë¶„ OS ì§€ì›.

## ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

1. [amazon ec2](https://ap-northeast-2.console.aws.amazon.com/ec2/home?region=ap-northeast-2#Home:) ì ‘ì†
2. ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘
   ![image](https://user-images.githubusercontent.com/96342941/214467259-3346a7a8-e1d0-4d4d-9ded-1a003d878b50.png)

   ì£¼í™©ìƒ‰ ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘ ëˆŒëŸ¬

3. ì´ë¦„, ìš°ë¶„íˆ¬, ìµœì‹  í”„ë¦¬í‹°ì–´ ì„ íƒ, ì•„í‚¤í…ì³ 64ë¹„íŠ¸

   ![image](https://user-images.githubusercontent.com/96342941/214467591-955f80ce-2b3b-4dca-9c17-72feff74b59d.png)

    - AMI(Amazon Machine Image): ìš´ì˜ì²´ì œ, ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì›í•˜ëŠ” í™˜ê²½ìœ¼ë¡œ ì„ íƒí•´ì„œ ì„œë²„ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.
4. ì¸ìŠ¤í„´ìŠ¤ ìœ í˜• â†’ t3.small ì„ íƒ
5. í‚¤ í˜ì–´
    1. ìˆìœ¼ë©´ ìˆëŠ”ê±° ì“°ê³ 
    2. ì—†ìœ¼ë©´ ìƒˆ í‚¤í˜ì–´ ìƒì„±. ì´ë¦„ ë„£ê³  rsa, .pem ì„ íƒ â†’ .pem íŒŒì¼ ë‹¤ìš´ë¡œë“œê¹Œì§€ í™•ì¸

       ![image](https://user-images.githubusercontent.com/96342941/214467671-e8610162-01ca-4c07-b27e-6b9bb76ceef2.png)

        - í‚¤í˜ì–´: ì„œë²„ì— ì ‘ì†í•˜ê¸° ìœ„í•œ ì—´ì‡ . ê³µê°œ í‚¤ ì•”í˜¸í™” ê¸°ë²•ìœ¼ë¡œ ì„œë²„ì—ëŠ” ê³µê°œí‚¤(public key)ë¥¼ ë‘ê³  ì‚¬ìš©ìëŠ” ê°œì¸í‚¤(private key)ë¥¼ ë“¤ê³  ì ‘ì†. ê°œì¸í‚¤ ìœ ì¶œë˜ë©´ ã„´ã„´
6. ë„¤íŠ¸ì›Œí¬ ì„¤ì •. ë³´ì•ˆ ê·¸ë£¹ ìƒì„± â†’ ssh, HTTPs, HTTP íŠ¸ë˜í”½ ì…‹ ë‹¤ í—ˆìš©

   ![image](https://user-images.githubusercontent.com/96342941/214467765-7fc6cf5e-01f4-4181-be3a-710c04b28e8f.png)

    - ë³´ì•ˆ ê·¸ë£¹: ë³´ì•ˆì„ ìœ„í•´ IPì™€ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì´ìš©í•´ ì •ì˜í•´ë‘ëŠ” ì„œë²„ ì ‘ì† ê·œì¹™. íŠ¹ì • ip,portì˜ ì ‘ì†, ê¸ˆì§€ ì—¬ë¶€ ì„¤ì • ê°€ëŠ¥
7. ê³ ê¸‰ ì„¸ë¶€ ì •ë³´ â†’ ìŠ¤íŒŸ ì¸ìŠ¤í„´ìŠ¤ ìš”ì²­ ê¼­ ì²´í¬

   ![image](https://user-images.githubusercontent.com/96342941/214467827-51c343e2-9e90-4a15-97f6-8138946d50f5.png)


ë!

![image](https://user-images.githubusercontent.com/96342941/214467897-a83efda8-413d-4eb7-a54a-68ea5cbf5b06.png)

ìŠì§€ë§ê³ !!! ë³´ì•ˆ ê·¸ë£¹ â†’ ì¸ë°”ìš´ë“œ ê·œì¹™ í¸ì§‘ì—ì„œ 8080 í¬íŠ¸ ì—´ì–´ì£¼ê¸°


## macìœ¼ë¡œ AWS EC2 ì ‘ì†
> [ë§¥ë¶ì´ë‚˜ macOSë¡œ AWS EC2 ì ‘ì†í•˜ëŠ” ë°©ë²•](https://www.notion.so/macOS-AWS-EC2-174098251a504cb1aec8c31498225796) << ë§ì´ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.

1. ssh key ìƒì„±
    1. í„°ë¯¸ë„ì— ì•„ë˜ ì½”ë“œ ì…ë ¥

        ```java
        cat ~/.ssh/id_rsa.pub
        ```

       no such file or directory ëœ¨ë©´ ìƒì„±ì´ ì•ˆ ë˜ì–´ ìˆë‹¤ëŠ” ì˜ë¯¸

    2. rsaí‚¤í˜ì–´ ìƒì„±. ì•„ë˜ ì½”ë“œ ì…ë ¥

        ```java
        ssh-keygen
        ```

       ë©”ì„¸ì§€ ëœ¨ë©´ ì—”í„° ëˆ„ë¥´ë©´ ë¨. ì–´ëŠ íŒŒì¼ì— í‚¤ ì €ì¥í•  ê±´ì§€, ë¹„ë°€ë²ˆí˜¸ëŠ” ë­˜ë¡œ í• ì§€ ë¬»ëŠ”ê±°ë¼ê³  í•¨.
       í‚¤ ìƒì„± ì™„ë£Œ ë˜ë©´ /Users/ë‚´ ì»´ì´ë¦„/.ssh í´ë”ì— ë§Œë“¤ì–´ì§

    3. ë‹¤ì‹œ ì…ë ¥í•˜ë©´

        ```java
        cat ~/.ssh/id_rsa.pub
        ---------------------
        ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDì–´ì©Œêµ¬ ì—„ì²­ê¸´ê±° ë‚˜ì˜´
        ```

2. pemíŒŒì¼ì„ ~/.ssh ê²½ë¡œì— ë³µì‚¬í•œë‹¤.
   ssh ì‹¤í–‰ì‹œ pemí‚¤ë¥¼ ìë™ìœ¼ë¡œ ì½ì–´ ì ‘ì†í•˜ê¸° ìœ„í•´ ë³µì‚¬í•˜ëŠ” ê±°ë¼ê³ ..
    1. ë³µì‚¬

        ```java
        cp pemíŒŒì¼ê²½ë¡œ/pemíŒŒì¼ëª… ~/.ssh/
        ```

    2. ssh ë””ë ‰í† ë¦¬ë¡œ ì´ë™

        ```java
        cd ~/.ssh
        ```

    3. pem íŒŒì¼ ê¶Œí•œ ë³€ê²½

        ```java
        chmod 600 pemíŒŒì¼ëª….pem
        ```

    4. config íŒŒì¼ ì„¤ì •

        ```java
        vi config
        ```

3. config íŒŒì¼ ì‘ì„±
   i ëˆŒëŸ¬ì„œ insert ëª¨ë“œ ì§„ì…, esc ëˆ„ë¥´ê³  :wq ì³ì„œ ì €ì¥í›„ ë¹ ì ¸ë‚˜ì˜¤ê¸°

    ```java
    Host ìƒì„±í•œ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë¶€ë¥¼ ë³„ëª…
    HostName EC2 ì¸ìŠ¤í„´ìŠ¤ í¼ë¸”ë¦­ IPv4 ì£¼ì†Œ
    User EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±í•  ë•Œ ë„£ì€ ì´ë¦„
    IdentityFile pemíŒŒì¼ê²½ë¡œ/pemíŒŒì¼ëª….pem
    ```

    ```java
    Host hyeon-instance
    HostName 3.36.xx.xx << ì¸ìŠ¤í„´ìŠ¤ ìƒˆë¡œ ë§Œë“¤ ë•Œë§ˆë‹¤ ipë„ ë°”ê¿”ì¤˜ì•¼í•¨. ë‹¹ì—°í•¨. ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ë¦„.
    User ubuntu
    IdentityFile ~/.ssh/hyeon.pem <<.sshì— ë³µì‚¬í•´ë†”ì„œ
    ```

4. config ê¶Œí•œ ìˆ˜ì •

    ```java
    chmod 700 config
    ```

5. sshë¡œ AWS EC2 ì„œë²„ ì ‘ì†

    ```java
    ssh ì„¤ì •í–ˆë˜ Hostë³„ëª…
    ```

    ```java
    @ë‚˜ .ssh % ssh hyeon-instance
    The authenticity of host 'xx.xx.xx.xx (xx.xx.xx.xx)' can't be established.
    ì–´ì©Œêµ¬ key fingerprint is ì–´ì©Œêµ¬.
    This key is not known by any other names
    Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
    ```

   yes ì¹˜ê³  ì—”í„°

    ```java
    The list of available updates is more than a week old.
    To check for new updates run: sudo apt update
    
    The programs included with the Ubuntu system are free software;
    the exact distribution terms for each program are described in the
    individual files in /usr/share/doc/*/copyright.
    
    Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
    applicable law.
    
    To run a command as administrator (user "root"), use "sudo <command>".
    See "man sudo_root" for details.
    
    ubuntu@ip-6:~$
    ```

---

## Docker ì„¤ì¹˜

1. ê´€ë¦¬ì ê¶Œí•œ

    ```java
    sudo su -
    ```

   ì…ë ¥í•˜ë©´ root@ip-ì–´ì©Œêµ¬ë¡œ ë°”ë€œ

2. ì„ ìƒë‹˜ ê¹ƒí—™ í´ë¡ í•´ì„œ ë„ì»¤ ì„¤ì¹˜

    ```java
    git clone https://github.com/Kyeongrok/docker_minikube_kubectl_install
    
    ------------------------------------------
    ~# llí•´ë³´ë©´ Docker_minikube ëœ¬ë‹¤
    total 28
    drwx------  5 root root 4096 Oct 11 10:51 ./
    drwxr-xr-x 19 root root 4096 Oct 11 08:31 ../
    -rw-r--r--  1 root root 3106 Oct 15  2021 .bashrc
    -rw-r--r--  1 root root  161 Jul  9  2019 .profile
    drwx------  2 root root 4096 Oct 11 08:31 .ssh/
    drwxr-xr-x  3 root root 4096 Oct 11 10:51 ***docker_minikube_kubectl_install/***
    drwx------  4 root root 4096 Oct 11 08:31 snap/
    ```

    ```java
    cd docker_mini~ ë¡œ ê²½ë¡œ ë³€ê²½
    ```

3. í„°ë¯¸ë„ì— ì•„ë˜ ëª…ë ¹ì–´ ì…ë ¥í•˜ê³  ë„ì»¤ ì„¤ì¹˜

    ```java
    sh docker_install.sh
    ```

   ì¤‘ê°„ì— ì—”í„° ëˆ„ë¥´ë¼ê³  í•  ë•Œ ì—”í„° ëˆ„ë¥´ê³ 

   ì„¤ì¹˜ ì˜ ëë‚˜ í™•ì¸í•´ë³´ë ¤ë©´ docker í•œ ë²ˆ ì³ë³´ë©´ ë¨. ëª…ë ¹ì–´ ë‚˜ì˜¤ë©´ ì˜ ëœ ê²ƒ.

4. nginx ë„ì›Œë³´ê¸° í„°ë¯¸ë„ì— ì•„ë˜ ì…ë ¥í•˜ê³  ì—”í„°

    ```java
    docker run -p 80:80 n
    ```

   ì¸í„°ë„· ì°½ì— í¼ë¸”ë¦­ ipv4 dns ì£¼ì†Œ:80 ì…ë ¥í•´ì„œ

   ![image](https://user-images.githubusercontent.com/96342941/214469590-3e8213e9-141a-4732-8f40-2e3113a21ff5.png)

   ì´ë ‡ê²Œ ëœ¨ë©´ ì˜ ëœ ê²ƒ.

   í„°ë¯¸ë„ì€ ì»¨íŠ¸ë¡¤+cë¡œ ë¹ ì ¸ë‚˜ì˜¬ ìˆ˜ ìˆìŒ.


## Dockerë¡œ MySql ë„ìš°ê¸°

```java
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=12341234 -d mysql

^ Keychainì— ë„£ì„ password
```

```java
í„°ë¯¸ë„ì— docker ps ì³ì„œ ëª©ë¡ì— Mysql ëœ¨ë©´ ë¨
```

### EC2 ë³´ì•ˆ ê·œì¹™ ì¶”ê°€í•´ì£¼ê¸°

(t3.small.docker)ì— ëŒ€í•œ ì¸ìŠ¤í„´ìŠ¤ ìš”ì•½ í˜ì´ì§€ ì¤‘ê°„ì— ë³´ë©´

ì„¸ë¶€ ì •ë³´ / ë³´ì•ˆ / ë„¤íŠ¸ì›Œí¬ â€¦ íƒ­ ìˆìŒ

ê±°ê¸°ì„œ ë³´ì•ˆ ì„ íƒ â†’ ì¸ë°”ìš´ë“œ ê·œì¹™ ìœ„ì— ë³´ì•ˆ ê·¸ë£¹ í´ë¦­ â†’ ì¸ë°”ìš´ë“œ ê·œì¹™ í¸ì§‘ â†’ ê·œì¹™ ì¶”ê°€

![image](https://user-images.githubusercontent.com/96342941/214469661-1d8fd8f9-eab5-44b3-b8f1-780ef1e9f9a2.png)

ìœ í˜• - MYSQL / 0.0.0.0/0

### MySQL Workbench ë‹¤ìš´ ë°›ê¸°

1. [MySQL :: MySQL Workbench](https://www.mysql.com/products/workbench/) ì›Œí¬ë²¤ì¹˜ ë‹¤ìš´

2. ì¶”ê°€
![image](https://user-images.githubusercontent.com/96342941/214470094-11b64541-72be-4d4a-9daf-adf0dc69c537.png)
í”ŒëŸ¬ìŠ¤ ë²„íŠ¼ í´ë¦­

3. ì •ë³´ ì…ë ¥
![image](https://user-images.githubusercontent.com/96342941/214470283-89955ee5-6636-4de0-9fe4-dd0019ffbcbd.png)
ì´ë¦„ì„ ì…ë ¥í•˜ê³  hostnameì— public ipv4 dnsë¥¼ ì…ë ¥í•œë‹¤.
ë§ˆì§€ë§‰ìœ¼ë¡œ Store in Keychain í´ë¦­í•´ì„œ ë¹„ë²ˆë„ ë„£ëŠ”ë‹¤.

4. ë!
![image](https://user-images.githubusercontent.com/96342941/214470682-e671abac-5a2d-4b47-9af1-3e669500eaed.png)